<!--
Copyright (C) 2023      Nanook Consulting. All rights reserved

This file is part of the PMIx Reference RunTime Environment (PRRTE), an
RTE that provides full PMIx support. For details, see the repository
at <https://github.com/openpmix/prrte/>.

PRRTE is free software distributed under the 3-clause BSD license. It
is distributed in the hope that it will be useful, but WITHOUT ANY
WARRANTY or implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE. See the full license statement at
<https://docs.prrte.org/en/latest/license.html> for details.

-->
<!DOCTYPE html>
<html lang="en-US">
<head>
<title>PRRTE DVM Configuration Tool</title>
<SCRIPT type="text/javascript">
<!--
function get_field(name,form)
{
  if (form.value)
     return name + "=" + form.value
  return "#" + name + "="
}

function get_field2(name,form)
{
  if (form.value)
     return name + "=" + form.value
  return ""
}

function get_radio_field_skipfirst(name,form)
{
  for (var i=1; i < form.length; i++)
  {
    if (form[i].checked)
    {
      return name + "=" + form[i].value
    }
  }
  return "#" + name + "="
}

function get_radio_value(form)
{
  for (var i=0; i < form.length; i++)
  {
    if (form[i].checked)
    {
      return form[i].value
    } else {
        return "0"
    }
  }
}

function get_checkbox_value(form)
{
  comma_list = ""
  for (var i=0; i < form.length; i++)
  {
    if (form[i].checked)
    {
     if (comma_list != "")
      comma_list = comma_list +","
     comma_list = comma_list+form[i].value
    }
  }
  return comma_list
}

function hide_box()
{
   var popup = document.getElementById('out_box');
   popup.style.visibility = 'hidden';

}

function displayfile()
{
  var printme = "# prte.conf file generated by prte-configurator.html.<br>" +
   "# Put this file on all nodes of your cluster.<br>" +
   "# See the prte.conf documentation for more information.<br>" +
   "#<br>" +
   "# Bootstrap Options<br>" +
   get_field("ClusterName",document.config.cluster_name) + "<br>" +
   get_field("DVMControllerHost",document.config.controller_host) + "<br>" +
   get_field("DVMControllerPort",document.config.controller_port) + "<br>" +
   get_field("PRTEDPort",document.config.prted_port) + "<br>" +
   get_field("DVMNodes",document.config.dvm_nodes) + "<br>" +
   "# <br>" +
   "# Operational Options<br>" +
   get_field("DVMTempDir",document.config.dvm_tmpdir) + "<br>" +
   get_field("SessionTmpDir",document.config.session_tmpdir) + "<br>" +
   "# <br>" +
   "# Logging Options<br>" +
   "ControllerLogJobState=" + get_radio_value(document.config.ctrlr_logjobstate) + "<br>" +
   "ControllerLogProcState=" + get_radio_value(document.config.ctrlr_logprocstate) + "<br>" +
   get_field("ControllerLogPath",document.config.ctrlr_logpath) + "<br>" +
   "PRTEDLogJobState=" + get_radio_value(document.config.prted_logjobstate) + "<br>" +
   "PRTEDLogProcState=" + get_radio_value(document.config.prted_logprocstate) + "<br>" +
   get_field("PRTEDLogPath",document.config.prted_logpath) + "<br>"

   //scroll(0,0);
   //var popup = document.getElementById('out_box');

   //popup.innerHTML = "<a href='javascript:hide_box();'>close</a><br>";
   //popup.innerHTML += "#BEGIN PRTE.CONF FILE<br><br>";
   //popup.innerHTML += printme;
   //popup.innerHTML += "<br><br>#END PRTE.CONF FILE<br>";
   //popup.innerHTML += "<a href='javascript:hide_box();'>close</a>";

   //popup.style.visibility = 'visible';

   // OLD CODE
   document.open();
   document.write(printme);
   document.close();
}

-->
</SCRIPT>
<!-- <div style='visibility:hidden;text-align:left;background:#ccc;border:1px solid black;position: absolute;left:100;z-index:1;padding:5;' id='out_box'></div> -->
</head>
<body>
<form name=config>
<H1>PRRTE Version @PRTE_MAJOR_VERSION@.@PRTE_MINOR_VERSION@ DVM Configuration Tool</H1>
<P>This configuration tool is intended to help system administrators create
a PRRTE configuration file that sets important configuration parameters.</P>

<P>While every attempt is made to maintain compatibility of the PRRTE
configuration tool and options across versions, we recommend that the
configuration file be built using the tool distributed with the version
being installed on your cluster. Some parameters will be set to default
values, but you can manually edit the resulting <I>prte.conf</I> file as desired
for greater flexibility. See the PRRTE documentation at <A HREF="https://docs.prrte.org/en/latest/configuration.html">https://docs.prrte.org/en/latest/configuration.html</A> for more
details about the configuration parameters.</P>

<P>Note that while PRRTE daemons create log files and other files as needed,
they treat the lack of parent directories (e.g., the specified "DVMTempDir")
as a fatal error. This prevents the daemons from running if critical file
systems are not mounted.</P>

<P>After you have filled in the fields of interest, use the
"Submit" button on the bottom of the page to display the resulting
<I>prte.conf</I> file. It will appear on your web browser. Save the file
in text format as <I>prte.conf</I> for use by the DVM.

<P><B>NOTE:</B> Hostname values should not be specified as fully qualified domain
names (e.g. use <I>foo</I> rather than <I>foo.bar.com</I>).
</P>

<P><B>NOTE:</B> This configuration file must be installed as <I>prte.conf</I> in the
<I>etc</I> directory under the PRRTE installation location on all nodes in your cluster.
For example, if PRRTE was installed in <I>/prrte</I>, then the configuration file
must be stored as <I>/prrte/etc/prte.conf</I> so that all prted daemons can find it.
</P>

<H2>Supported Options</H2>
The following options are supported by PRRTE v@PRTE_MAJOR_VERSION@.@PRTE_MINOR_VERSION@.

<H3>Bootstrap Options</H3>

<b>ClusterName</b>: <input type="text" name="cluster_name" value="cluster">
<BR>
The name of the cluster upon which the DVM is executing. This is used by PRRTE
to form the namespace for the DVM daemons, which is taken as <I><clustername>-prte-dvm</I>.
Using different names for each of your clusters is important if you use a single
database to record information from multiple PRRTE-managed clusters.
<BR>
<BR>

<b>DVMControllerHost</b>: <input type="text" name="controller_host" value="host0">
<BR>
The host upon which the DVM controller will be executing. The <I>prted</I> that
finds itself booting onto this host will declare itself to be the system controller
and will initialize itself accordingly.
<BR>
<BR>

<b>DVMControllerPort</b>: <input type="text" name="controller_port" value="7817">
<BR>
The TCP port upon which the
DVM controller will be listening for connections from its <I>prted</I> daemons
on the remaining system nodes.
<BR>
<BR>

<b>PRTEDPort</b>: <input type="text" name="prted_port" value="7818">
<BR>
`The TCP port upon which each
<I>prted</I> daemon will be listening for connections from its peer daemons
on the other system nodes.
<BR>
<BR>

<b>DVMNodes</b>: <input type="text" name="dvm_nodes" value="">
<BR>
Provides a regular expression
identifying the nodes that upon which user applications can run. IP addresses can
be provided in place of hostnames if desired.The regular expression can consist of
a simple comma-delimited list of hostnames, or a comma-delimited list of hostname
ranges (e.g., "linux0,linux[2-10]"), or a PMIx "native" regular expression.
<BR>
<BR>


<H3>Operational Options</H3>

<b>DVMTempDir</b>: <input type="text" name="dvm_tmpdir" value="/tmp">
<BR>
The temporary directory that the
DVM daemons and controller are to use as the base for their session directories.
Working files/directories for the DVM will be placed under this location.
<BR>
<BR>

<b>SessionTmpDir</b>: <input type="text" name="session_tmpdir" value="/tmp">
<BR>
The temporary directory that
the DVM daemons are to use as the base for session directories for all
application sessions. Working files for each session will be placed under
this location, separated out into a directory for each session.
<BR>
<BR>

<H3>Logging Options</H3>

<b>ControllerLogJobState</b>: <input type="button" name="ctrlr_logjobstate" value="0">
<BR>
Directs the DVM
controller to log each DVM-launched job state transition. Log entry includes
the namespace of the job, the state to which it is transitioning, and the
date/time stamp when the transition was ordered.
<BR>
<BR>

<b>ControllerLogProcState</b>: <input type="radio" name="ctrlr_logprocstate" value="0">
Directs the DVM
controller to log each process (in a DVM-launched job) state transition.
Log entry includes the namespace and rank of the process, the state to
which it is transitioning, and the date/time stamp when the transition was
ordered.
<BR>
<BR>

<b>ControllerLogPath</b>: <input type="text" name="ctrlr_logpath" value="">
<BR>
Path to where the logs are to be written. If a relative path is provided,
then the directory will be created under the <I>DVMTempDir</I> location. The
path defaults to the specified SessionTmpDir in the absence of any input
to this field. The log filename is formatted as <I>prtectrlr-<hostname>-log</I>.
<BR>
<BR>

<b>PRTEDLogJobState</b>: <input type="radio" name="prted_logjobstate" value="0">
<BR>
Directs each <I>prted</I>
in the DVM to log each DVM-launched job state transition. Log entry includes
the namespace of the job, the state to which it is transitioning, and the
date/time stamp when the transition was ordered.
<BR>
<BR>

<b>PRTEDLogProcState</b>: <input type="radio" name="prted_logprocstate" value="0">
<BR>
Directs each <I>prted</I>
in the DVM to log each process (in a DVM-launched job) state transition.
Log entry includes the namespace and rank of the process, the state to
which it is transitioning, and the date/time stamp when the transition was
ordered.
<BR>
<BR>

<b>PRTEDLogPath</b>: <input type="text" name="prted_logpath" value="">
<BR>
Path to where the logs are to be written. If a relative path is provided,
then the directory will be created under the <I>DVMTempDir</I> location. The
path defaults to the specified SessionTmpDir in the absence of any input
to this field. The log filename is formatted as <I>prted-<hostname>-log</I>.

<BR>
<BR>
<input type=button value="Submit" onClick="javascript:displayfile()">
<input type=reset value="Reset Form">
</form>
<hr>
<p>
<a href="disclaimer.html" target="_blank" class="privacy">Legal Notices</a><br>
Last modified 17 June 2020</p>
</body>
</html>
